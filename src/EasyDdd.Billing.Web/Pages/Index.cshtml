@page
@model IndexModel
@{
    ViewData["Title"] = "Tms Statements";
}

<div>
	<h1 class="display-4">Statements</h1>
	
	<div class="mt-3">
		<ul class="nav nav-tabs" id="statementListTabs" role="tablist">
			<li class="nav-item">
				<a class="nav-link active" id="pending-tab" data-toggle="tab" href="#pending" role="tab" aria-selected="true">Pending</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" id="processed-tab" data-toggle="tab" href="#processed" role="tab" aria-selected="false">Processed</a>
			</li>
		</ul>

		<div class="tab-content" id="statementLists">
			<div class="tab-pane fade show active"
				id="pending"
				role="tabpanel"
				aria-labelledby="pending-tab">
				
				<table class="table table-responsive">
					<thead>
					<tr>
						<th>Statement Number</th>
						<th>Billing Period</th>
						<th>Bill-To Account</th>
						<th>Bill-To Location</th>
						<th>Created At</th>
					</tr>
					</thead>
					<tbody>
					@foreach (var statement in Model.PendingStatements)
					{
						<tr>
							<td><a asp-page="/StatementSpotlight" asp-route-id="@statement.Id">@statement.Id</a></td>
							<td>@($"{statement.BillingPeriod.Start:MM/dd/yyyy} - {statement.BillingPeriod.End:MM/dd/yyyy}")</td>
							<td>@statement.BillToAccount</td>
							<td>@statement.BillToLocation</td>
							<td>@statement.CreatedAt.ToString("MM/dd/yyyy")</td>
						</tr>
					}
					@if (!Model.PendingStatements.Any())
					{
						<tr>
							<td colspan="5"><i>There are no pending statements.</i></td>
						</tr>
					}
					</tbody>
				</table>
			</div>

			<div class="tab-pane fade"
				id="processed"
				role="tabpanel"
				aria-labelledby="processed-tab">

				<table class="table table-responsive">
					<thead>
					<tr>
						<th>Statement Number</th>
						<th>Billing Period</th>
						<th>Bill-To Account</th>
						<th>Bill-To Location</th>
						<th>Processed At</th>
					</tr>
					</thead>
					<tbody>
					@foreach (var statement in Model.ProcessedStatements)
					{
						<tr>
							<td><a asp-page="/StatementSpotlight" asp-route-id="@statement.Id">@statement.Id</a></td>
							<td>@($"{statement.BillingPeriod.Start:MM/dd/yyyy} - {statement.BillingPeriod.End:MM/dd/yyyy}")</td>
							<td>@statement.BillToAccount</td>
							<td>@statement.BillToLocation</td>
							<td>@statement.ProcessedAt.ToString("MM/dd/yyyy")</td>
						</tr>
					}
					
					@if (!Model.ProcessedStatements.Any())
					{
						<tr>
							<td colspan="5"><i>There are no processed statements.</i></td>
						</tr>
					}
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>

<script src="~/lib/signalr/dist/browser/signalr.js"></script>
<script>
	'use strict';

	var connection = new signalR.HubConnectionBuilder()
		.withUrl('/shipmentsHub')
		.build();

	connection
		.start()
		.then(() => console.log('Connection started!'))
		.catch(err => console.log(err.toString()));

	connection.on('receiveMessage', function (shipmentId, messageType, message) {
		alert(shipmentId + ' ' + messageType + ' ' + message.shipment.status);
	});
</script>